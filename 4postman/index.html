<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONPath Example</title>
    <!-- Axios CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- JSONPath CDN -->
    <script src="https://cdn.jsdelivr.net/npm/jsonpath/jsonpath.min.js"></script>
</head>
<body>
    <h1>JSONPath Example</h1>
    <button onclick="fetchData()">Fetch Data</button>
    <button onclick="insertIds()">Insert IDs</button>
    <button onclick="editRecord()">Edit Record</button>
    <button onclick="addRecord()">Add Record</button>

    <pre id="output"></pre>

    <script>
        let data = [];

        // Fetch JSON data from the URL
        async function fetchData() {
            try {
                const response = await axios.get('https://tarek-bg.github.io/web/1data/pets-data.json');
                data = response.data;
                document.getElementById('output').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Insert IDs to all records using JSONPath
        function insertIds() {
            jsonpath.apply(data, '$[*]', (value, path) => {
                value.id = path.split('[')[1].split(']')[0];
                return value;
            });
            document.getElementById('output').textContent = JSON.stringify(data, null, 2);
        }

        // Edit a record using PUT
        async function editRecord() {
            const recordId = prompt('Enter the ID of the record to edit:');
            const newName = prompt('Enter the new name:');
            const newAge = prompt('Enter the new age:');

            const record = jsonpath.query(data, `$[?(@.id == ${recordId})]`)[0];
            if (record) {
                record.name = newName;
                record.age = newAge;

                try {
                    await axios.put(`https://tarek-bg.github.io/web/1data/pets-data.json/${recordId}`, record);
                    document.getElementById('output').textContent = JSON.stringify(data, null, 2);
                } catch (error) {
                    console.error('Error updating record:', error);
                }
            } else {
                alert('Record not found!');
            }
        }

        // Add a new record using POST
        async function addRecord() {
            const newName = prompt('Enter the name of the new record:');
            const newAge = prompt('Enter the age of the new record:');

            const newRecord = {
                id: data.length.toString(),
                name: newName,
                age: newAge
            };

            data.push(newRecord);

            try {
                await axios.post('https://tarek-bg.github.io/web/1data/pets-data.json', newRecord);
                document.getElementById('output').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                console.error('Error adding record:', error);
            }
        }
    </script>
</body>
</html>